## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

<aside>
ğŸ’¡ ì—°ê´€ì„ ê°€ì§€ëŠ” ê°ì²´ê°€ ìˆì„ ë•Œ í•˜ë‚˜ì˜ ê°ì²´ë§Œì´ ë‹¤ë¥¸ ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê²½ìš°

</aside>

### í…Œì´ë¸”ì—ì„œì˜ ì—°ê´€ê´€ê³„

ì¼ë°˜ì ì¸ í…Œì´ë¸”ì—ì„œì˜ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ **************ì–‘ë°©í–¥**************ì´ë‹¤. 

| id | íŒ€_ì´ë¦„ |
| --- | --- |
| 1 | ì„±ì¤€íŒ€ |
| 2 | ëª…í™˜íŒ€ |

```sql
SELECT *
FROM team t
JOIN member m
ON t.id = m.íŒ€_id;

SELECT 
FROM member m
JOIN team t
ON m.íŒ€_id = t.id;
```

â†’ ì–´ëŠ í…Œì´ë¸”ì—ì„œë“ ì§€ ì—°ê´€ëœ í…Œì´ë¸”ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

### ê°ì²´ì—ì„œì˜ ì—°ê´€ê´€ê³„

```java
class Team {
	Member member;
}

class Member {
};
```

â†’ Teamì—ì„œëŠ” Memberë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆì§€ë§Œ Memberì—ì„œëŠ” Teamì„ ì°¸ì¡°í•  ìˆ˜ ì—†ë‹¤. (ë‹¨ë°©í–¥)

```java
class Team {
	Member member;
}

class Member {
	Team team;
};
```

â†’ ì„œë¡œë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤. (ì–‘ë°©í–¥)

******ì •ë¦¬******

- ê°ì²´ëŠ” ì°¸ì¡°ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
    - ë‹¨ë°©í–¥
- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.

### ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ë€?

<aside>
ğŸ’¡ ì°¸ì¡°í•˜ëŠ” ê°ì²´ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ë§¤í•‘í•˜ëŠ” ê²ƒ

</aside>

```java
class Member {
	Team team;
}
```

| id | name | team_id (FK) |
| --- | --- | --- |

â†’ `team`ê³¼ `team_id`ë¥¼ ë§¤í•‘í•˜ëŠ” ê²ƒ

### @JoinColumn

<aside>
ğŸ’¡ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•  ë•Œ ì‚¬ìš©í•œë‹¤.

</aside>

- `name` : ë§¤í•‘í•  ì™¸ë˜ í‚¤ ì´ë¦„
- `referencedColumnName` : ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ëŒ€ìƒ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª…
- `foreignKey` : ì™¸ë˜ í‚¤ ì œì•½ì¡°ê±´ì„ ì§ì ‘ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
- `@Column`ì˜ ì†ì„±ì— ì‚¬ìš©ë˜ëŠ” ì œì•½ ì¡°ê±´ ì˜µì…˜ë“¤
    - `unique`, `nullable`, â€¦

## ì—°ê´€ê´€ê³„ ì‚¬ìš©

Member â†’ Teamì´ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ì¼ ê²½ìš°ë¥¼ ê°€ì •

### ì €ì¥

```java
Team teamA = em.find(Team.class, 1L);

Member member = new Member("member1", "íšŒì›1");
membmer.setTeam(teamA);

em.persist(member);
```

| id | name | team_id |
| --- | --- | --- |
| 1 | íšŒì›1 | 1 |

### ì¡°íšŒ

ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.

- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
- JPQL ì‚¬ìš©

************************************ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰************************************

```java
Member member = em.find(Member.class, 1L);
Team team = member.getTeam();
```

********************************************************ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‚¬ìš©********************************************************

```java
select m from Member m join m.team where m.id = 1
```

### ìˆ˜ì •

```java
Member member = em.find(Member.class, 1L);
member.setTeam(team2);
```

### ì œê±°

```java
Member member = em.find(Member.class, 1L);
member.setTeam(null);
```

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

```java
public class Member {
	//...

	@ManyToOne
	private Team team;

	//..
}

public class Team {
	//...

	@OneToMany(mappedBy = "team")
	private List<Member> members = new ArrayList<>();

	//...
}
```

## ì—°ê´€ê´€ê³„ ì£¼ì¸

- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•œë‹¤.
- ì—”í‹°í‹°ë¥¼ ë‹¨ë°©í–¥ìœ¼ë¡œ ë§¤í•‘í•˜ë©´ ì°¸ì¡°ë¥¼ í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ë§¤í•‘í•´ì£¼ë©´ ëœë‹¤.
- ì–‘ë°©í–¥ ë§¤í•‘ì„ í•˜ë©´ ì°¸ì¡°ê°€ 2ê°œì´ê¸° ë•Œë¬¸ì— ì–´ë–¤ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ë§¤í•‘í•´ì¤„ì§€ ì •í•´ì¤˜ì•¼ í•œë‹¤.

â†’ ì°¸ì¡° ì¤‘ í•˜ë‚˜ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ë§¾ì´í•´ì£¼ì–´ì•¼ í•˜ëŠ”ë° ì´ê²ƒì´ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ë‹¤.

- ì–‘ë°©í–¥ ë§¤í•‘ ì‹œ ì—°ê´€ê´€ê³„ ì£¼ì¸ì„ ê¼­ ì§€ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.
- ì—°ê´€ê´€ê³„ ì£¼ì¸ìœ¼ë¡œ ê²°ì •ëœ ê°ì²´ë§Œì´ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ì™€ ë§¤í•‘ë˜ê³  ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬ í•  ìˆ˜ ìˆë‹¤. (ì£¼ì¸ì´ ì•„ë‹Œìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥)
- `@OneToMany`ì™€ ê°™ì€ ì—°ê´€ê´€ê³„ë¥¼ ì§€ì •í•´ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì— `mappedBy` ì˜µì…˜ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì—°ê´€ê´€ê³„ ì£¼ì¸ì„ ì§€ì •í•´ì¤„ ìˆ˜ ìˆë‹¤.
- `mappedBy`ì— ì§€ì •ëœ í•„ë“œê°€ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ëœë‹¤.
- ì—°ê´€ê´€ê³„ ì£¼ì¸ì€ í…Œì´ë¸”ì—ì„œ ì™¸ë˜í‚¤ë¥¼ ê°€ì§€ê³  ìˆëŠ” ìª½ì„ ì—°ê´€ê´€ê³„ ì£¼ì¸ìœ¼ë¡œ ì„¤ì •í•œë‹¤.
    - ì¦‰, 1:N ê´€ê³„ì—ì„œ í•­ìƒ Nìª½ì´ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— `@ManyToOne`ì´ ì ìš©ë˜ëŠ” ìª½ì´ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ëœë‹¤.
    

```java
Team team1 = em.find(Team.class, 1L);

Member member = em.find(Member.class, 1L);
member.setTeam(team1);  -> íšŒì›í…Œì´ë¸”ì— ë°ì´í„° ì €ì¥ ì‹œ ì™¸ë˜í‚¤ë„ í•¨ê»˜ ì €ì¥

team1.getMembers().add(member);  -> í…Œì´ë¸”ì— ì™¸ë˜í‚¤ ë°˜ì˜ X
```

### ìˆœìˆ˜í•œ ê°ì²´ê¹Œì§€ ê³ ë ¤í•œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

â†’ ê°ì²´ ê´€ì ì—ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì—ë„ ì—°ê´€ê´€ê³„ë¥¼ ê°€ì§€ëŠ” ê°ì²´ë¥¼ ì €ì¥í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```java
public class Member {
	//...

	@ManyToOne
	private Team team;

	//...

	public void setTeam(Team team) {
		if (this.team != null) {
			this.team.getMembers().remove(this);
		}
		this.team = team;
		this.getMembers().add(this);
	}
}
```
