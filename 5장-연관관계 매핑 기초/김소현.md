# ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ

---

## 5.1 ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

```
- íšŒì›ê³¼ íŒ€ì´ ìˆë‹¤.
- íšŒì›ì€ í•˜ë‚˜ì˜ íŒ€ì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆë‹¤.
- íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ì´ë‹¤.
```

**ê°ì²´ ì—°ê´€ê´€ê³„**

- íšŒì› ê°ì²´ëŠ” í•„ë“œë¡œ íŒ€ ê°ì²´ì™€ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
- íšŒì› ê°ì²´ì™€ íŒ€ ê°ì²´ëŠ” ë‹¨ë°©í–¥ ê´€ê³„
    
    â†’ íšŒì›ì´ íŒ€ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒ ê°€ëŠ¥
    
    â†’ íŒ€ì´ íšŒì› ê°ì²´ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒ ë¶ˆê°€ëŠ¥
    

**í…Œì´ë¸” ì—°ê´€ê´€ê³„**

- íšŒì› í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤(FK)ë¡œ íŒ€ í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
- íšŒì› í…Œì´ë¸”ê³¼ íŒ€ í…Œì´ë¸”ì€ ì–‘ë°©í–¥ ê´€ê³„
    
    â†’ ì–‘ìª½ìœ¼ë¡œ JOIN ê°€ëŠ¥
    

**ê°ì²´ ì—°ê´€ê´€ê³„ VS í…Œì´ë¸” ì—°ê´€ê´€ê³„**

- ê°ì²´ëŠ” ì°¸ì¡°ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.

### 5.1.1 ìˆœìˆ˜í•œ ê°ì²´ ì—°ê´€ê´€ê³„

íšŒì›1ê³¼ íšŒì›2ëŠ” íŒ€1ì— ì†í•˜ê³ , ì†í•œ íŒ€ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

```java
public class Member {

	private String id;
	private String username;

	private Team team; // ì°¸ì¡°

	public void setTeam(Team team) {
		this.team = team;
	}

// Getter
// Setter

}

public class Team {
	
	private String id;
	private String name;

	// Getter
	// Setter

}
```

```java
public static void main(String[] args) {

	// ìƒì„±ì
	Member member1 = new Member("member1", "íšŒì›1");
	Member member2 = new Member("member2", "íšŒì›2");
	Team team1 = new Team("team1", "íŒ€1");

	member1.setTeam(team1);
	member2.setTeam(team2);

	Team findTeam = member1.getTeam();
}
```

<aside>
ğŸ’« **ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰**
ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆë‹¤.

</aside>

### 5.1.2 í…Œì´ë¸” ì—°ê´€ê´€ê³„

<aside>
ğŸ’« **ì¡°ì¸**
ì™¸ë˜ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆë‹¤.

</aside>

### 5.1.3 ê°ì²´ ê´€ê³„ ë§¤í•‘

```java
@Entity
public class Member {
	
	@Id
	@Column(name = "member_id")
	private String id;

	private String username;

	@ManyToOne
	@JoinColumn(name = "team_id")
	private Team team;

	public void setTeam(Team team) {
		this.team = team;
	}

	...

}
```

```java
@Entity
public class Team {
	
	@Id
	@Column(name = "team_id")
	private String id;

	private String name;

	...

}
```

### 5.1.4 @JoinColumn

| ì†ì„± | ê¸°ëŠ¥ | ê¸°ë³¸ê°’ |
| --- | --- | --- |
| name | ë§¤í•‘í•  ì™¸ë˜ í‚¤ ì´ë¦„ | {í•„ë“œëª…}_{ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì¹¼ëŸ¼ëª…} |
| referencedColumnName | ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ëŒ€ìƒ í…Œì´ë¸”ì˜ ì¹¼ëŸ¼ëª… | ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì¹¼ëŸ¼ëª… |
| foreignKey(DDL) | ì™¸ë˜ í‚¤ ì œì•½ì¡°ê±´ì„ ì§ì ‘ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
ì´ ì†ì„±ì€ í…Œì´ë¸”ì„ ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©í•œë‹¤. |  |
| unique |  |  |
| nullable |  |  |
| insertable |  |  |
| updatable |  |  |
| columnDefinition |  |  |
| table |  |  |

### 5.1.5 @ManyToOne

| ì†ì„± | ê¸°ëŠ¥ | ê¸°ë³¸ê°’ |
| --- | --- | --- |
| optional | falseë¡œ ì„¤ì •í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ í•­ìƒ ìˆì–´ì•¼ í•œë‹¤. | true |
| fetch | ê¸€ë¡œë²Œ íŒ¨ì¹˜ ì „ëµì„ ì‚¬ìš©í•œë‹¤. | @ManyToOne=FetchType.EAGER
@OneToMany=FetchType.LAZY |
| cascade | ì˜ì†ì„± ì „ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤. |  |
| targetEntity | ì—°ê´€ëœ ì—”í‹°í‹°ì˜ íƒ€ì… ì •ë³´ë¥¼ ì„¤ì •í•œë‹¤. (ê±°ì˜ ì‚¬ìš© X) |  |

---

## 5.2 ì—°ê´€ê´€ê³„ ì‚¬ìš©

### 5.2.1 ì €ì¥

```java
public void testSave() {

	Team team1 = new Team("team1", "íŒ€1");
	em.persist(team1);

	Member member1 = new Member("member1", "íšŒì›1");
	member1.setTeam(team1); // íšŒì› -> íŒ€ ì°¸ì¡°
	em.persist(member1); // ì €ì¥

	Member member2 = new Member("member2", "íšŒì›2");
	member2.setTeam(team1);
	em.persist(member2);
}
```

### 5.2.2 ì¡°íšŒ

```java
Member member = em.find(Member.class, "member1");
Team team = member.getTeam();
```

```java
private static void queryLogicJoin(EntityManager em) {

	String jpql = "select m from Member m join m.team t where t.name = :teamName";

	List<Member> resultList = em.createQuery(jpql, Member.class)
															.setParameter("teamName", "íŒ€1")
															.getResultList();
}
```

### 5.2.3 ìˆ˜ì •

```java
private static void updateRelation(EntityManager em) }

	Team team2 = new Team("team2", "íŒ€2");
	em.persist(team2);

	Member member = em.find(Member.class, "member1");
	member.setTeam(team2);
}
```

ì°¸ì¡°í•˜ëŠ” ëŒ€ìƒë§Œ ë³€ê²½í•˜ë©´ ë‚˜ë¨¸ì§€ëŠ” JPAê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬

### 5.2.4 ì—°ê´€ê´€ê³„ ì œê±°

```java
private static void deleteRelation(EntityManager em) {
	
	Member member1 = em.find(Member.class, "member1");
	member1.setTeam(null); // ì—°ê´€ê´€ê³„ ì œê±°
}
```

### 5.2.5 ì—°ê´€ëœ ì—”í‹°í‹° ì‚­ì œ

ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ê¸°ì¡´ì— ìˆë˜ ì—°ê´€ê´€ê³„ë¥¼ ë¨¼ì € ì œê±°í•˜ê³  ì‚­ì œí•´ì•¼ í•œë‹¤.

â†’ íŒ€ì„ ì‚­ì œí•˜ë ¤ë©´ íŒ€ê³¼ íšŒì›ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì‚­ì œ í›„ ì—”í‹°í‹° ì‚­ì œ ê°€ëŠ¥

---

## 5.3 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

### 5.3.1 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ë§¤í•‘

```java
@Entity
public class Team {
	
	@Id
	@Column(name = "team_id")
	private String id;

	private String name;

	@OneToMany(mappedBy = "team")
	private List<Member> members = new ArrayList<Member>();

}
```

### 5.3.2 ì¼ëŒ€ë‹¤ ì»¬ë ‰ì…˜ ì¡°íšŒ

```java
public void biDirection() }

	Team team = em.find(Team.class, "team1");
	List<Member> members = team.getMembers(); // ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
}
```

---

## 5.4 ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬
- ì—”í‹°í‹°ë¥¼ ë‹¨ë±¡í–¥ìœ¼ë¡œ ë§¤í•‘í•˜ë©´ ì°¸ì¡°ë¥¼ í•˜ë‚˜ë§Œ ì‚¬ìš©
- ì—”í‹°í‹°ë¥¼ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì„¤ì •í•˜ë©´ ê°ì²´ì˜ ì°¸ì¡°ëŠ” ë‘˜ì¸ë° ì™¸ë˜ í‚¤ëŠ” í•˜ë‚˜ì´ë‹¤.
- ë‘ ê°ì²´ ì—°ê´€ê´€ê³„ ì¤‘ í•˜ë‚˜ë¥¼ ì •í•´ì„œ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ë° ì´ê²ƒì„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë¼ í•¨

### 5.4.1 ì–‘ë°©í–¥ ë§¤í•‘ì˜ ê·œì¹™: ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ê´€ê³„ì™€ ë§¤í•‘ë˜ê³  ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. ë°˜ë©´ì— ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ í•  ìˆ˜ ìˆë‹¤.

- ì£¼ì¸ì€ mappedBy ì†ì„±ì„ ì´ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ì„ ì‚¬ìš©í•´ì„œ ì†ì„±ì˜ ê°’ìœ¼ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì§€ì •í•´ì•¼ í•œë‹¤.

### 5.4.2 ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³

ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ê´€ê³„ì™€ ë§¤í•‘ë˜ê³  ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥í•˜ê³  ì™¸ë˜ í‚¤ë¥¼ ë³€ê²½í•˜ì§€ëŠ” ëª»í•œë‹¤.

---

## 5.5 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ì €ì¥

ì—°ê´€ê´€ê³„ ì£¼ì¸ì¸ [Member.team](http://Member.team) í•„ë“œë¥¼ í†µí•´ì„œ íšŒì›ê³¼ íŒ€ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í•˜ê³  ì €ì¥

ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ, ì£¼ì¸ì´ ì•„ë‹Œ ë°©í–¥ì€ ê°’ì„ ì„¤ì •í•˜ì§€ ì•Šì•„ë„ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜í•´ ì™¸ë˜ í‚¤ ê°’ì´ ì •ìƒ ì…ë ¥ëœë‹¤.

---

## 5.6 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì˜ ì£¼ì˜ì 

ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì—ëŠ” ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šê³ , ì£¼ì¸ì´ ì•„ë‹Œ ê³³ì—ë§Œ ê°’ì„ ì…ë ¥í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ ì£¼ì˜í•´ì•¼ í•œë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ì— ì™¸ë˜ í‚¤ ê°’ì´ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ì§€ ì•Šìœ¼ë©´ ìœ„ ì‚¬í•­ì„ ì˜ì‹¬í•´ë³´ì•„ì•¼ í•œë‹¤.

### 5.6.1 ìˆœìˆ˜í•œ ê°ì²´ê¹Œì§€ ê³ ë ¤í•œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

ê°ì²´ ê´€ì ì—ì„œ ì–‘ìª½ ë°©í–¥ì— ëª¨ë‘ ê°’ì„ ì…ë ¥í•´ì£¼ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•˜ë‹¤. (ìˆœìˆ˜í•œ ê°ì²´ ìƒíƒœì—ì„œ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥)

```java
public void testSave() {

	Team team1 = new Team("team1", "íŒ€1");
	em.persist(team1);

	Member member1 = new Member("member1", "íšŒì›1");
	member1.setTeam(team1); // íšŒì› -> íŒ€ ì°¸ì¡°
	team1.getMembers().add(member1);
	em.persist(member1); // ì €ì¥

	Member member2 = new Member("member2", "íšŒì›2");
	member2.setTeam(team1);
	team1.getMembers().add(member2);
	em.persist(member2);
}
```

ìˆœìˆ˜í•œ ê°ì²´ ìƒíƒœì—ì„œë„ ë™ì‘í•˜ë©°, í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë„ ì •ì‚° ì…ë ¥ëœë‹¤.

`[Member.team](http://Member.team)` : ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸, ì™¸ë˜ í‚¤ ê´€ë¦¬

`Team.members` : ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹˜, ì €ì¥ ì‹œì— ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.

### 5.6.2 ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ

í•œ ë²ˆì— ì–‘ë°©í–¥ ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë©”ì†Œë“œë¥¼ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¼ í•œë‹¤.

```java
public class Member {

	private Team team;

	// ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ë‘ ì½”ë“œëŠ” í•˜ë‚˜ì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „
	public void setTeam(Team team) {
		this.team = team;
		team.getMembers().add(this);
	}

	...
}
```

### 5.6.3 ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ ì‘ì„± ì‹œ ì£¼ì˜ì‚¬í•­

ì—°ê´€ê´€ê³„ë¥¼ ë³€ê²½í•  ë•Œ ê¸°ì¡´ ì—°ê´€ê´€ê³„ëŠ” ì œê±°í•´ì£¼ì–´ì•¼ í•œë‹¤.

```java
public void setTeam(Team team) {

	// ê¸°ì¡´ íŒ€ê³¼ ê´€ê³„ë¥¼ ì œê±°
	if (this.team != null) {
		this.team.getMembers().remove(this);
	}

	this.team = team;
	team.getMembers().add(this);
}
```
