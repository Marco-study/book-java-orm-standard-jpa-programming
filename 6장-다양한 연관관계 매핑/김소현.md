# ë‹¤ì–‘í•œ ì—°ê´€ê´€ê³„ ë§¤í•‘

## 6.1 ë‹¤ëŒ€ì¼

### 6.1.1 ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ [N:1]

```java
@Entity
public class Member [

	@Id @GeneratedValue
	@Column(name = "MEMBER_ID")
	private Long id;

	private String username;

	@ManyToOne
	@JoinColumn(name = "TEAM_ID")
	private Team team;

	...
}
```

íšŒì›ì€ íŒ€ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤. (`Member.team`)

```java
@Entity
public class Team {

	@Id @GeneratedValue
	@Column(name = "TEAM_ID")
	private Long id;

	private String name;

	...
}
```

íŒ€ì€ íšŒì› ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•  ìˆ˜ ì—†ë‹¤.

### 6.1.2 ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ [N:1, 1:N]

```java
@Entity
public class Member [

	@Id @GeneratedValue
	@Column(name = "MEMBER_ID")
	private Long id;

	private String username;

	@ManyToOne
	@JoinColumn(name = "TEAM_ID")
	private Team team;

	public void setTeam(Team team) {
		this.team = team;

		// ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
		if (!team.getMembers().contains(this)) {
			team.getMembers().add(this);
		}
}
```

```java
@Entity
public class Team {

	@Id @GeneratedValue
	@Column(name = "TEAM_ID")
	private Long id;

	private String name;

	@OneToMany(mappedBy = "team")
	private List<Member> members = new ArrayList<Member>();

	public void addMember(Member member) {
		this.members.add(member);

		// ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
		if (member.getTeam() != this) {
			member.setTeam(this);
		}
}
```

- ì–‘ë°©í–¥ì€ **ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìª½ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸**ì´ë‹¤.
    
    â†’ í•­ìƒ ë‹¤(N)ì— ì™¸ë˜ í‚¤ê°€ ì¡´ì¬
    
    â†’ ì£¼ì¸ì´ ì•„ë‹Œ ìª½(Team)ì€ ì¡°íšŒë¥¼ ìœ„í•œ JPQL ë˜ëŠ” ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì—ì„œ ì‚¬ìš©
    
- ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ **ì„œë¡œë¥¼ ì°¸ì¡°**í•´ì•¼ í•œë‹¤.
    
    â†’ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ ì‚¬ìš© (`setTeam()` `addMember()`)
    
    â†’ ì–‘ìª½ ëª¨ë‘ ì‘ì„±í•  ìˆ˜ë„ ìˆë‹¤. (ë‹¨, ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì£¼ì˜, í•œ ìª½ë§Œ í˜¸ì¶œ)
    

---

## 6.2 ì¼ëŒ€ë‹¤

<aside>
ğŸ’¡ í•˜ë‚˜ì˜ íŒ€ì€ ì—¬ëŸ¬ íšŒì›ì„ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.

</aside>

`Collection` `List` `Set` `Map` ì¤‘ í•˜ë‚˜ ì‚¬ìš©

### 6.2.1 ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ [1:N]

ë°˜ëŒ€í¸ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•œë‹¤.

```java
@Entity
public class Team {

	@Id @GeneratedValue
	@Column(name = "TEAM_ID")
	private Long id;

	private String name;

	@OneToMany
	@JoinColumn(name = "TEAM_ID")
	private List<Member> members = new ArrayList<Member>();

	...
}
```

```java
@Entity
public class Member [

	@Id @GeneratedValue
	@Column(name = "MEMBER_ID")
	private Long id;

	private String username;

	...
}
```

- ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì˜ ë‹¨ì 
    
    â†’ ë§¤í•‘í•œ ê°ì²´ê°€ ê´€ë¦¬í•˜ëŠ” ì™¸ë˜ í‚¤ê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì— ì¡´ì¬ (Member í…Œì´ë¸”ì„ ë”°ë¡œ update í•„ìš”)
    
- ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ë³´ë‹¤ëŠ” **ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘**ì„ ì‚¬ìš©í•˜ì (ê¶Œì¥)
    
    â†’ ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ì™¸ë˜ í‚¤ê°€ ë³¸ì¸ í…Œì´ë¸”ì— ì¡´ì¬
    

### 6.2.2 ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ [1:N, N:1]

```java
@Entity
public class Team {

	@Id @GeneratedValue
	@Column(name = "TEAM_ID")
	private Long id;

	private String name;

	@OneToMany
	@JoinColumn(name = "TEAM_ID")
	private List<Member> members = new ArrayList<Member>();

	...
}
```

```java
@Entity
public class Member [

	@Id @GeneratedValue
	@Column(name = "MEMBER_ID")
	private Long id;

	private String username;

	@ManyToOne
	@JoinColumn(name = "TEAM_ID", insertable = false, updatable = false)
	private Team team;

	...
}
```

- ë‘˜ ë‹¤ ê°™ì€ í‚¤ë¥¼ ê´€ë¦¬
    
    â†’ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ì•„ë‹Œ ìª½(Member)ì€ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì¶”ê°€(`insertable`, `updatetable`)
    
- ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì´ ê°€ì§€ëŠ” ë‹¨ì ì„ ë˜‘ê°™ì´ ê°€ì§€ë¯€ë¡œ, ë˜ë„ë¡ **ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘**ì„ ì‚¬ìš©í•  ê²ƒ

---

## 6.3 ì¼ëŒ€ì¼ [1:1]

<aside>
ğŸ’¡ ì–‘ìª½ì´ ì„œë¡œ í•˜ë‚˜ì˜ ê´€ê³„ë§Œ ê°€ì§„ë‹¤.

</aside>

- **ì£¼ í…Œì´ë¸”**ì— ì™¸ë˜ í‚¤
    
    â†’ ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ë¥¼ ë‘ê³  ëŒ€ìƒ í…Œì´ë¸” ì°¸ì¡°
    
    â†’ ì£¼ í…Œì´ë¸”ë§Œ í™•ì¸í•´ë„ ëŒ€ìƒ í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ê°€ ìˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
    
- **ëŒ€ìƒ í…Œì´ë¸”**ì— ì™¸ë˜ í‚¤
    
    â†’ ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ë¥¼ ë‘ê³  ì£¼ í…Œì´ë¸” ì°¸ì¡°
    
    â†’ í…Œì´ë¸” ê´€ê³„ë¥¼ ì¼ëŒ€ì¼ì—ì„œ ì¼ëŒ€ë‹¤ë¡œ ë³€ê²½í•  ë•Œ í…Œì´ë¸” êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€ ê°€ëŠ¥
    

### 6.3.1 ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤

`ë‹¨ë°©í–¥`

```java
@Entity
public class Member {

	@Id @GeneratedValue
	@Column(name = "MEMBER_ID")
	private Long id;

	private String username;

	@OneToOne
	@JoinColumn(name = "LOCKER_ID")
	private Locker locker;

	...
}

@Entity
public class Locker {

	@Id @GeneratedValue
	@Column(name = "LOCKER_ID")
	private Long id;

	private String name;

	...
}
```

`ì–‘ë°©í–¥`

```java
@Entity
public class Member {

	@Id @GeneratedValue
	@Column(name = "MEMBER_ID")
	private Long id;

	private String username;

	@OneToOne
	@JoinColumn(name = "LOCKER_ID")
	private Locker locker;

	...
}

@Entity
public class Locker {

	@Id @GeneratedValue
	@Column(name = "LOCKER_ID")
	private Long id;

	private String name;

	@OneToOne(mappedBy = "locker")
	private Member member;

	...
}
```

- Member í…Œì´ë¸”ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ë¯€ë¡œ, Member ì—”í‹°í‹°ì˜ `Member.locker` ê°€ ì—°ê´€ê´€ê³„ ì£¼ì¸
- ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ì•„ë‹Œ ìª½(Locker)ì€ `mappedBy` ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹˜ìœ¼ë¡œ ì„¤ì •

### 6.3.2 ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤

`ë‹¨ë°©í–¥`

ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ë‹¨ë°©í–¥ ê´€ê³„ëŠ” JPAì—ì„œ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.

`ì–‘ë°©í–¥`

```java
@Entity
public class Member {

	@Id @GeneratedValue
	@Column(name = "MEMBER_ID")
	private Long id;

	private String username;

	@OneToOne(mappedBy = "member")
	private Locker locker;

	...
}

@Entity
public class Locker {

	@Id @GeneratedValue
	@Column(name = "LOCKER_ID")
	private Long id;

	private String name;

	@OneToOne
	@JoinColumn(name = "MEMBER_ID")
	private Member member;

	...
}
```

---

## 6.4 ë‹¤ëŒ€ë‹¤ [N:N]

<aside>
ğŸ’¡ ì •ê·œí™” ëœ í…Œì´ë¸” 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ í‘œí˜„ ë¶ˆê°€ â†’ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ë‚´ëŠ” **ì—°ê²° í…Œì´ë¸”** ì‚¬ìš©

</aside>

### 6.4.1 ë‹¤ëŒ€ë‹¤: ë‹¨ë°©í–¥

```java
@Entity
public class Member {

	@Id @Column(name = "MEMBER_ID")
	private String id;

	private String username;

	@ManyToMany
	@JoinTable(name = "MEMBER_PRODUCT",
	joinColumns = @JoinColumn(name = "MEMBER_ID"),
	inverseJoinColumns = @JoinColumn(name = "PRODUCT_ID"))
	private List<Product> products = new ArrayList<Product>();

	...
}
```

```java
@Entity
public class Product {

	@Id @Column(name = "PRODUCT_ID")
	private String id;

	private String name;

	...
}
```

- ì—°ê²° ì—”í‹°í‹° ì—†ì´ ë§¤í•‘ ê°€ëŠ¥
    
    â†’ `@ManyToMany` `@JoinTable`
    
    ---
    
    - `@JoinTable.name` : ì—°ê²° í…Œì´ë¸” ì§€ì • (ex. MEMBER_PRODUCT)
    - `@JoinTable.joinColumns` : í˜„ì¬ ë°©í–¥ê³¼ ë§¤í•‘í•  ì¡°ì¸ ì»¬ëŸ¼ ì •ë³´ ì§€ì • (ex. MEMBER_ID)
    - `@JoinTalbe.inverseJoinColumns` : ë°˜ëŒ€ ë°©í–¥ê³¼ ë§¤í•‘í•  ì¡°ì¸ ì»¬ëŸ¼ ì •ë³´ ì§€ì • (ex. PRODUCT_ID)

### 6.4.2 ë‹¤ëŒ€ë‹¤: ì–‘ë°©í–¥

```java
@Entity
public class Member {

	@Id @Column(name = "MEMBER_ID")
	private String id;

	private String username;

	@ManyToMany
	@JoinTable(name = "MEMBER_PRODUCT",
	joinColumns = @JoinColumn(name = "MEMBER_ID"),
	inverseJoinColumns = @JoinColumn(name = "PRODUCT_ID"))
	private List<Product> products = new ArrayList<Product>();

	public void addProduct(Product product) }
		...

		products.add(product);
		product.getMembers().add(this);
	}
}
```

```java
@Entity
public class Product {

	@Id @Column(name = "PRODUCT_ID")
	private String id;

	private String name;

	@ManyToMany(mappedBy = "products") // ì—­ë°©í–¥ ì¶”ê°€
	private List<Member> members;

	...
}
```

### 6.4.3 ë‹¤ëŒ€ë‹¤: ë§¤í•‘ì˜ í•œê³„ì™€ ê·¹ë³µ ì—°ê²° ì—”í‹°í‹° ì‚¬ìš©

- ë‹¨ìˆœíˆ ë‘ í…Œì´ë¸”ì˜ idë§Œ ë‹´ê³  ëë‚˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì—°ê²° í…Œì´ë¸”ì— ë” í•„ìš”í•œ ì¹¼ëŸ¼ì´ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.
    
    â†’ ì—°ê²° ì—”í‹°í‹°ë¥¼ ë§Œë“¤ê³  ì¶”ê°€ë¡œ í•„ìš”í•œ ì¹¼ëŸ¼ë“¤ì„ ë§¤í•‘í•´ì•¼ í•œë‹¤. (ex. íšŒì›ìƒí’ˆ(MemberProduct) ì—”í‹°í‹°)
    

```java
@Entity
public class Member {

	@Id @Column(name = "MEMBER_ID")
	private String id;

	// ì—­ë°©í–¥
	@OneToMany(mappedBy = "member")
	private List<MemberProduct> memberProducts;

	...
}
```

**íšŒì›ìƒí’ˆ ì—”í‹°í‹°** ìª½ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸**

```java
@Entity
public class Product {

	@Id @Column(name = "PRODUCT_ID")
	private String id;

	private String name;

	...
}
```

`ìƒí’ˆ â†’ íšŒì›ìƒí’ˆ`ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ ê¸°ëŠ¥ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨í•¨.

```java
@Entity
@IdClass(MemberProductId.class)
public class MemberProduct {

	@Id
	@ManyToOne
	@JoinColumn(name = "MEMBER_ID")
	private Member member; // MemberProductId.memberì™€ ì—°ê²°

	@Id
	@ManyToOne
	@JoinColumn(name = "PRODUCT_ID")
	private Product product; // MemberProductId.productì™€ ì—°ê²°

	private int orderAmount;

	...
}
```

```java
public class MemberProductId implements Serializable {

	private String member; // MemberProduct.memberì™€ ì—°ê²°
	private String product; // MemberProduct.productì™€ ì—°ê²°

	// hashCode and equals

	@Override
	public boolean equals(Object o) { ... }

	@Override
	public int hashCode() { ... }
```

- ë³µí•© ê¸°ë³¸ í‚¤
    
    â†’ ë³µí•© í‚¤ëŠ” ë³„ë„ì˜ ì‹ë³„ì í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì•¼ í•œë‹¤. (`@IdClass` ë¡œ ì§€ì •)
    
    â†’ Serializableì„ êµ¬í˜„í•´ì•¼ í•œë‹¤.
    
    â†’ equalsì™€ hashCode ë©”ì†Œë“œë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
    
    â†’ ê¸°ë³¸ ìƒì„±ìê°€ ìˆì–´ì•¼ í•œë‹¤.
    
    â†’ ì‹ë³„ì í´ë˜ìŠ¤ëŠ” public ì´ì–´ì•¼ í•œë‹¤.
    
    â†’ `@IdClass` ëŒ€ì‹  `@EmbeddedId` ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.
    
- ì‹ë³„ ê´€ê³„
    
    â†’ ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë°›ì•„ì„œ ìì‹ ì˜ `ê¸°ë³¸ í‚¤ + ì™¸ë˜ í‚¤` ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ
    

### 6.4.4 ë‹¤ëŒ€ë‹¤: ìƒˆë¡œìš´ ê¸°ë³¸ í‚¤ ì‚¬ìš© (ì¶”ì²œ)

<aside>
ğŸ’¡ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ëŠ” ëŒ€ë¦¬ í‚¤ë¥¼ Long ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ

</aside>

- ê°„í¸í•˜ë‹¤.
- ì˜êµ¬íˆ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ë¹„ì¦ˆë‹ˆìŠ¤ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.

```java
@Entity
public class Order {

	@Id @GeneratedValue
	@Column(name = "ORDER_ID")
	private Long id;

	@ManyToOne
	@JoinColumn(name = "MEMBER_ID")
	private Member member;

	@ManyToOne
	@JoinColumn(name = "PRODUCT_ID")
	private Product product;

	private int orderAmount;

	...
}
```

### 6.4.5 ë‹¤ëŒ€ë‹¤ ì—°ê´€ê´€ê³„ ì •ë¦¬

ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤ ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ë‚´ê¸° ìœ„í•´ ì—°ê²° í…Œì´ë¸”ì„ ë§Œë“¤ ë•Œ ì‹ë³„ìë¥¼ ì–´ë–»ê²Œ êµ¬ì„±í• ì§€ ì„ íƒ

`ì‹ë³„ ê´€ê³„` : ë°›ì•„ì˜¨ ì‹ë³„ìë¥¼ ê¸°ë³¸ í‚¤ + ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©

`ë¹„ì‹ë³„ ê´€ê³„` : ë°›ì•„ì˜¨ ì‹ë³„ìëŠ” ì™¸ë˜ í‚¤ë¡œë§Œ ì‚¬ìš©í•˜ê³  ìƒˆë¡œìš´ ì‹ë³„ì ì¶”ê°€ (ì¶”ì²œ)
